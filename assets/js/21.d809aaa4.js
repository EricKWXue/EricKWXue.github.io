(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{340:function(n,s,a){"use strict";a.r(s);var t=a(0),r=Object(t.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h1",{attrs:{id:"spring-boot-源码知识基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-源码知识基础"}},[n._v("#")]),n._v(" Spring boot 源码知识基础")]),n._v(" "),a("h2",{attrs:{id:"_1-spring-boot-启动与配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-spring-boot-启动与配置"}},[n._v("#")]),n._v(" 1. Spring boot 启动与配置")]),n._v(" "),a("ul",[a("li",[a("p",[n._v("spring boot 初始化工程")]),n._v(" "),a("ul",[a("li",[n._v("spring官网： "),a("a",{attrs:{href:"https://start.spring.io/",target:"_blank",rel:"noopener noreferrer"}},[n._v("Spring Initializr"),a("OutboundLink")],1)]),n._v(" "),a("li",[n._v("IDE插件：新建工程 -> Spring Initializr")])])]),n._v(" "),a("li",[a("p",[n._v("spring boot 工程结构")])])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("|-- springdemo\n    |-- .gitignore\n    |-- mvnw\n    |-- mvnw.cmd\n    |-- pom.xml\n    |-- .mvn\n    |   |-- wrapper\n    |       |-- maven-wrapper.jar\n    |       |-- maven-wrapper.properties\n    |       |-- MavenWrapperDownloader.java\n    |-- src\n        |-- main\n        |   |-- java\n        |   |   |-- com.eric.springdemo\n        |   |       |-- SpringdemoApplication.java\n        |   |       |-- controller\n        |   |       |-- service\n        |   |-- resources\n        |       |-- application.properties\n        |       |-- static\n        |       |-- templates\n        |-- test\n            |-- java\n                |-- com.eric.springdemo\n                    |-- SpringdemoApplicationTests.java\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br")])]),a("h2",{attrs:{id:"_2-spring-boot-约定大于配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-spring-boot-约定大于配置"}},[n._v("#")]),n._v(" 2. Spring boot 约定大于配置")]),n._v(" "),a("ul",[a("li",[n._v("启动文件xxxApplication.java的存放位置")]),n._v(" "),a("li",[n._v("配置文件application.properties或者application.yml的存放位置")])]),n._v(" "),a("h2",{attrs:{id:"_3-spring-boot-打包文件结构解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-spring-boot-打包文件结构解析"}},[n._v("#")]),n._v(" 3. Spring boot 打包文件结构解析")]),n._v(" "),a("p",[n._v("名词解释："),a("code",[n._v("fat-jar")]),n._v("，即：jar中包含着jar。")]),n._v(" "),a("p",[n._v("如下面的jar结构所示，显然spring boot打成的jar包不是标准的jar结构，实为fat-jar")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("|-- springdemo-0.0.1-SNAPSHOT\n    |-- BOOT-INF\n    |   |-- classes\n    |   |   |-- application.properties\n    |   |   |-- com.eric.springdemo\n    |   |       |-- SpringdemoApplication.class\n    |   |       |-- controller\n    |   |       |-- service\n    |   |-- lib\n    |       |-- classmate-1.5.1.jar\n    |       |-- hibernate-validator-6.0.18.Final.jar\n    |       |-- jackson-annotations-2.10.0.jar\n    |       |-- ... (more lib)\n    |-- META-INF\n    |   |-- MANIFEST.MF\n    |   |-- maven\n    |       |-- com.eric\n    |           |-- springdemo\n    |               |-- pom.properties\n    |               |-- pom.xml\n    |-- org\n        |-- springframework\n            |-- boot\n                |-- loader\n                    |-- ExecutableArchiveLauncher.class\n                    |-- JarLauncher.class\n                    |--... (more class)\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br")])]),a("ul",[a("li",[a("code",[n._v("BOOT-INF")])])]),n._v(" "),a("p",[n._v("classes：当前当前项目编译后生成的字节码文件和配置文件")]),n._v(" "),a("p",[n._v("lib：所有的依赖包")]),n._v(" "),a("ul",[a("li",[a("code",[n._v("META-INF")])])]),n._v(" "),a("p",[n._v("MANIFEST.MF")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("Manifest-Version: 1.0\nImplementation-Title: springdemo\nImplementation-Version: 0.0.1-SNAPSHOT\nStart-Class: com.eric.springdemo.SpringdemoApplication\nSpring-Boot-Classes: BOOT-INF/classes/\nSpring-Boot-Lib: BOOT-INF/lib/\nBuild-Jdk-Spec: 1.8\nSpring-Boot-Version: 2.2.1.RELEASE\nCreated-By: Maven Archiver 3.4.0\nMain-Class: org.springframework.boot.loader.JarLauncher\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br")])]),a("ul",[a("li",[a("code",[n._v("org.springframework.boot.loader")])])]),n._v(" "),a("p",[n._v("这个文件夹由插件spring-boot-maven-plugin生成，如果需要研究其源码，可以引用其源码坐标")]),n._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("<")]),n._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(">")])]),n._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("<")]),n._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(">")])]),n._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("</")]),n._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(">")])]),n._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("<")]),n._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(">")])]),n._v("spring-boot-loader"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("</")]),n._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(">")])]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("</")]),n._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(">")])]),n._v("\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("p",[a("code",[n._v("启动流程与设计思想说明")]),n._v("zml")]),n._v(" "),a("p",[n._v("1.执行java -jar springdemo-0.0.1-SNAPSHOT.jar")]),n._v(" "),a("p",[n._v("2.读取META-INF/MANIFEST.MF文件的Main-Class")]),n._v(" "),a("p",[n._v("3.由默认的应用类加载器加载执行Main-Class文件，即org.springframework.boot.loader.JarLauncher")]),n._v(" "),a("p",[n._v("4.JarLauncher中生成一个自定义类加载器，加载BOOT-INF在的class和jar")]),n._v(" "),a("p",[n._v("5.JarLauncher读取Start-Class，即com.eric.springdemo.SpringdemoApplication，自定义类加载器加载这个class，通过反射执行其中main函数")]),n._v(" "),a("p",[n._v("6.到此，整个jar包就被完全执行了。")]),n._v(" "),a("p",[n._v("备注：可以使用JWDI远程调式JarLauncher的执行流程")]),n._v(" "),a("p",[a("code",[n._v("FAQ")])]),n._v(" "),a("p",[n._v("1.为什么不直接把Main-Class定义成com.eric.springdemo.SpringdemoApplication？")]),n._v(" "),a("p",[n._v("com.eric.springdemo.SpringdemoApplication位于BOOT-INF/classes下，因为默认应用类加载器只能执行外层的class，若该class文件在某个文件夹下是执行不了的。")]),n._v(" "),a("p",[n._v("如果把com.eric.springdemo.SpringdemoApplication直接放外层，是可以执行，但是它依赖的lib却是执行不了的。因为根据jar包打包规则，jar内不能有jar，且class外不能有莫名的文件夹，因为这些在执行jar时，都是加载不了的。若想要加载，按照旧的打包机制，得把内部依赖的jar解压缩，且class都得暴露在外面。但是一旦这样做，class文件会非常混乱，自己编写的class和依赖的class揉在一起了，且容易出现同名class冲突覆盖的情况。")]),n._v(" "),a("p",[n._v("所以spring boot采用这种fat-jar的机制重新制定打包规则，且巧妙的通过自定义类记载器加载内部的依赖jar以及class。")]),n._v(" "),a("h2",{attrs:{id:"_4-spring-boot-启动流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-spring-boot-启动流程"}},[n._v("#")]),n._v(" 4. Spring boot 启动流程")]),n._v(" "),a("p",[n._v("启动代码："),a("code",[n._v("new SpringApplication(primarySources).run(args)")]),n._v("，分为两个部分")]),n._v(" "),a("ul",[a("li",[a("p",[n._v("创建SpringApplication对象")]),n._v(" "),a("ul",[a("li",[n._v("初始化"),a("code",[n._v("resourceLoader")]),n._v("，资源加载器，此处为null")]),n._v(" "),a("li",[n._v("初始化"),a("code",[n._v("primarySources")]),n._v("，spring boot项目启动的入口类")]),n._v(" "),a("li",[n._v("初始化"),a("code",[n._v("webApplicationType")]),n._v("，应用类型，此处为web项目，即servlet")]),n._v(" "),a("li",[n._v("初始化"),a("code",[n._v("initializers")]),n._v("，从META-INF/spring.factories中寻找所有实现ApplicationContextInitializer接口的实现类，加载他们的实例对象")]),n._v(" "),a("li",[n._v("初始化"),a("code",[n._v("listeners")]),n._v("，从META-INF/spring.factories中寻找所有实现了ApplicationListener接口的实现类，加载他们的实例对象")]),n._v(" "),a("li",[n._v("初始化"),a("code",[n._v("mainApplicationClass")]),n._v("，调用main函数启动的类")])])]),n._v(" "),a("li",[a("p",[n._v("调用run方法")]),n._v(" "),a("ul",[a("li",[n._v("计时开始")]),n._v(" "),a("li",[n._v("从META-INF/spring.factories中寻找所有实现SpringApplicationRunListener接口的实现类，加载他们的实例")]),n._v(" "),a("li",[n._v("ApplicationContext初始化开始，listeners.starting();")]),n._v(" "),a("li",[n._v("准备环境environment")]),n._v(" "),a("li",[n._v("listeners.environmentPrepared(environment);")]),n._v(" "),a("li",[n._v("打印banner")]),n._v(" "),a("li",[n._v("创建ApplicationContext")]),n._v(" "),a("li",[n._v("从META-INF/spring.factories中寻找所有实现SpringBootExceptionReporter接口的实现类，加载他们的实例")]),n._v(" "),a("li",[n._v("准备ApplicationContext")]),n._v(" "),a("li",[n._v("listeners.contextPrepared(context);")]),n._v(" "),a("li",[n._v("加载ApplicationContext")]),n._v(" "),a("li",[n._v("listeners.contextLoaded(context);")]),n._v(" "),a("li",[n._v("刷新ApplicationContext")]),n._v(" "),a("li",[n._v("计时结束")]),n._v(" "),a("li",[n._v("listeners.started(context);")]),n._v(" "),a("li",[n._v("加载ApplicationRunner和CommandLineRunner")]),n._v(" "),a("li",[n._v("listeners.running(context);")])])])]),n._v(" "),a("h2",{attrs:{id:"_5-spring-boot-常用注解解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-spring-boot-常用注解解析"}},[n._v("#")]),n._v(" 5. Spring boot 常用注解解析")]),n._v(" "),a("ul",[a("li",[a("p",[n._v("@SpringBootApplication")])]),n._v(" "),a("li",[a("p",[n._v("@Configuration")])])]),n._v(" "),a("p",[n._v("相当于专门用于配置bean的xml，表明这个一个配置类。成员方法上的@Bean相当于"),a("code",[n._v("<bean>")]),n._v(",方法会返回一个对象，这个对象要注册为Spring应用上下文中的bean")]),n._v(" "),a("ul",[a("li",[a("p",[n._v("@EnableAutoConfiguration")])]),n._v(" "),a("li",[a("p",[n._v("@ComponentScan")])])]),n._v(" "),a("p",[n._v("相当于xml配置中的"),a("code",[n._v("<context:component-scan>")]),n._v("，默认扫描当前路径以及子路径下所有的包，当然也可以指定扫描哪些包路径")]),n._v(" "),a("ul",[a("li",[n._v("@Conditional")])]),n._v(" "),a("p",[n._v("与接口Condition配合使用，通常应用于配置类中，符合条件才加在配置类或实例到spring容器中。衍生注解@ConditionalOnBean、@ConditionalOnProperty等等")])])}),[],!1,null,null,null);s.default=r.exports}}]);