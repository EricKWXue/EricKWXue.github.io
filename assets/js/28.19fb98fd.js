(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{351:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nas安装clash代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nas安装clash代理"}},[s._v("#")]),s._v(" NAS安装Clash代理")]),s._v(" "),t("h2",{attrs:{id:"_1-需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-需求"}},[s._v("#")]),s._v(" 1. 需求")]),s._v(" "),t("p",[s._v("买了日版的switch，就会在玩游戏的道路上碰到很多问题，比如购买游戏啊、下载游戏啊、更新游戏啊...之类的都需要访问远在海外网站。\n如果没有代理，遇到以上问题，真的寸步难行！")]),s._v(" "),t("h2",{attrs:{id:"_2-规划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-规划"}},[s._v("#")]),s._v(" 2. 规划")]),s._v(" "),t("p",[s._v("用家里的NAS（威联通）专门设立一个Clash-Proxy的虚拟机（docker）作为代理接入点，凡是需要访问外网的都走这条代理通道。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/views-img/2022020201/clash-proxy.png",alt:"clash-proxy"}})]),s._v(" "),t("h2",{attrs:{id:"_3-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装"}},[s._v("#")]),s._v(" 3. 安装")]),s._v(" "),t("h3",{attrs:{id:"_3-1-准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-准备"}},[s._v("#")]),s._v(" 3.1 准备")]),s._v(" "),t("p",[s._v("在威联通的Container Station所在目录下新建两个目录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/share/Container/clash/config    #存放clash配置文件\n/share/Container/clash/ui        #存放控制面板UI\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_3-2-安装镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-安装镜像"}},[s._v("#")]),s._v(" 3.2 安装镜像")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("镜像选择："),t("code",[s._v("dreamacro/clash")]),s._v("， 路径：https://hub.docker.com/r/dreamacro/clash")])]),s._v(" "),t("li",[t("p",[s._v("端口映射：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 端口映射关系，本机端口:docker端口\n17890:7890      # 混合代理端口\n17891:7891      # socket5代理端口，可能不需要\n19090:9090      # UI端口\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("关键文件目录映射")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 文件目录映射关系，本机目录:docker目录\n/share/Container/clash/config:/root/.config/clash    # 配置文件\n/share/Container/clash/ui:/ui dreamacro/clash        # UI目录\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])]),s._v(" "),t("p",[s._v("综上docker命令：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run -d --name clash-client --restart always -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17890")]),s._v(":7890 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17891")]),s._v(":7891 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19090")]),s._v(":9090 -v /share/Container/clash/config:/root/.config/clash -v /share/Container/clash/ui:/ui dreamacro/clash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-3-配置代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-配置代理"}},[s._v("#")]),s._v(" 3.3 配置代理")]),s._v(" "),t("p",[s._v("clash-client安装好了之后，就可以把配置加进去了")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O /share/Container/clash/config.yaml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("订阅链接"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O /share/Container/clash/Country.mmdb https://www.sub-speeder.com/client-download/Country.mmdb\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("打开congfig.yaml看一眼，里面内容可能不是我们想要的yml格式，比如：订阅链接可能直接返回一个base64码，这时候需要手动解析下，然后再把解析好的yaml贴到congfig.yaml里")])]),s._v(" "),t("p",[s._v("例如：一个没有错误的config.yaml应该是这样的")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mixed-port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7890")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allow-lan")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bind-address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rule\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("log-level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" info\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external-controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0:9090'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external-ui")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/ui'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#...后面会跟一些dns信息、代理节点信息")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("保存后重启clash-client，至此clash代理就做好了")]),s._v(" "),t("h3",{attrs:{id:"_3-4-控制面板（可有可无）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-控制面板（可有可无）"}},[s._v("#")]),s._v(" 3.4 控制面板（可有可无）")]),s._v(" "),t("p",[s._v("推荐两个常用的UI")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1. 官方的Dashboard : https://github.com/Dreamacro/clash-dashboard/tree/gh-pages\n2. 第三方的很炫酷的Dashboard: https://github.com/haishanh/yacd/tree/gh-pages\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("打开上述路径，把gh-pages这个下面的UI文件全部down下来，放到nas的"),t("code",[s._v("/share/Container/clash/ui")]),s._v("目录下，这样控制面板的UI就有了")]),s._v(" "),t("p",[s._v("为了能够通过UI访问并看到clash工作情况，还需要在config.yaml增加些外部访问配置")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external-controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0:9090'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#secret: '123qwe'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external-ui")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/ui'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("保存后重启clash-client，至此clash的控制面板就做好了")]),s._v(" "),t("p",[s._v("打开浏览器访问"),t("code",[s._v("http://192.168.3.154:19090/ui")]),s._v("，输入nas的IP地址和端口19090，就能成功访问clash了")]),s._v(" "),t("p",[t("img",{attrs:{src:"/views-img/2022020201/clash-ui.png",alt:"clash-ui"}})]),s._v(" "),t("h2",{attrs:{id:"_4-客户端使用代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-客户端使用代理"}},[s._v("#")]),s._v(" 4. 客户端使用代理")]),s._v(" "),t("h3",{attrs:{id:"_4-1-linux客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-linux客户端"}},[s._v("#")]),s._v(" 4.1 linux客户端")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加http代理、https代理、不需要代理的路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("http_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.3.154:17890"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("https_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.3.154:17890"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("no_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost;127.*;10.*;172.16.*;172.17.*;172.18.*;172.19.*;172.20.*;172.21.*;172.22.*;172.23.*;172.24.*;172.25.*;172.26.*;172.27.*;172.28.*;172.29.*;172.30.*;172.31.*;192.168.*"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_4-2-windows客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-windows客户端"}},[s._v("#")]),s._v(" 4.2 windows客户端")]),s._v(" "),t("p",[s._v('"设置" --\x3e "网络与internet" --\x3e "代理"，手动设置代理服务器，并打开')]),s._v(" "),t("ul",[t("li",[t("p",[s._v("地址："),t("code",[s._v("192.168.3.154")])])]),s._v(" "),t("li",[t("p",[s._v("端口："),t("code",[s._v("17890")])])]),s._v(" "),t("li",[t("p",[s._v("不走代理的地址："),t("code",[s._v("localhost;127.*;10.*;172.16.*;172.17.*;172.18.*;172.19.*;172.20.*;172.21.*;172.22.*;172.23.*;172.24.*;172.25.*;172.26.*;172.27.*;172.28.*;172.29.*;172.30.*;172.31.*;192.168.*")])])])]),s._v(" "),t("h3",{attrs:{id:"_4-3-git客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-git客户端"}},[s._v("#")]),s._v(" 4.3 git客户端")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局配置(如果要配置local，也是一样的)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global http.proxy http://192.168.3.154:17890\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global https.proxy https://192.168.3.154:17890\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global --unset http.proxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global --unset https.proxy\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#clone代理")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone -c http.proxy"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.154:17890"')]),s._v(" https://github.com/XXXXXXXXX.git\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);