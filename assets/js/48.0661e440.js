(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{372:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"flowable工作流引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flowable工作流引擎"}},[t._v("#")]),t._v(" flowable工作流引擎")]),t._v(" "),a("h2",{attrs:{id:"_1-工作流介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-工作流介绍"}},[t._v("#")]),t._v(" 1. 工作流介绍")]),t._v(" "),a("p",[t._v("工作流（Workflow），是对工作流程及其各操作步骤之间业务规则的抽象、概括描述。 工作流建模，即将工作流程中的工作如何前后组织在一起的逻辑和规则，在计算机中以恰当的模型表達并对其实施计算。")]),t._v(" "),a("p",[t._v("工作流要解决的主要问题是：为实现某个业务目标，利用计算机在多个参与者之间按某种预定规则自动传递文档、信息或者任务。")]),t._v(" "),a("p",[t._v("说白了，就是对系统的业务流程进行自动化管理，所以工作流是建立在业务流程的基础上，系统核心根本上还是业务流程，工作流只是协助进行业务流程管理。所以即使没有工作流业务系统也可以开发运行，只不过有了工作流可以更好的管理业务流程，提高系统的可扩展性。")]),t._v(" "),a("p",[t._v("工作流的适用场景：")]),t._v(" "),a("ol",[a("li",[t._v("关键业务流程：订单、报价处理、合同审核、客户电话处理、供应链管理等")]),t._v(" "),a("li",[t._v("行政管理类：出差申请、加班申请、请假申请、用车申请、各种办公用品申请、购买申请、日报周报等凡是原来手工流转处理的行政表单。")]),t._v(" "),a("li",[t._v("人事管理类：员工培训安排、绩效考评、职位变动处理、员工档案信息管理等。")]),t._v(" "),a("li",[t._v("财务相关类：付款请求、应收款处理、日常报销处理、出差报销、预算和计划申请等。")]),t._v(" "),a("li",[t._v("客户服务类：客户信息管理、客户投诉、请求处理、售后服务管理等。")]),t._v(" "),a("li",[t._v("特殊服务类：ISO系列对应流程、质量管理对应流程、产品数据信息管理、贸易公司报关处理、物流公司货物跟踪处理等各种通过表单逐步手工流转完成的任务均可应用工作流软件自动规范地实施。")])]),t._v(" "),a("h2",{attrs:{id:"_2-flowable工作流引擎说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-flowable工作流引擎说明"}},[t._v("#")]),t._v(" 2. flowable工作流引擎说明")]),t._v(" "),a("p",[t._v("Flowable是一个用java语言写的轻量级工作流引擎，与Activiti框架相比开发方便快速，易与Spring Boot等各种框架快速整合。如果项目中需要快速实现一些工作流的相关功能那么用此框架是一个不错的选择。")]),t._v(" "),a("p",[t._v("Flowable支持多种不同流程引擎：")]),t._v(" "),a("ol",[a("li",[t._v("内容引擎 ContentEngine")]),t._v(" "),a("li",[t._v("身份识别引擎 IdmEngine")]),t._v(" "),a("li",[t._v("表单引擎 FormEngine")]),t._v(" "),a("li",[t._v("决策引擎 DmnEngine")]),t._v(" "),a("li",[t._v("流程引擎 ProcessEngine")])]),t._v(" "),a("p",[t._v("工作流项目可以多个引擎一起用，但主要还是使用流程引擎，其他引擎作为辅助选项使用。")]),t._v(" "),a("h3",{attrs:{id:"_2-1-service说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-service说明"}},[t._v("#")]),t._v(" 2.1 service说明")]),t._v(" "),a("p",[t._v("Flowable支持多种不同流程引擎，每个引擎都会有自己的service。")]),t._v(" "),a("p",[t._v("我们主要以流程引擎 ProcessEngine为例，介绍下这个引擎提供的service接口")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessEngine")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Engine")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//......")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Service providing access to the repository of process definitions and deployments.定义流程和部署流程")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RepositoryService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRepositoryService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Allows the creation of deployments and the starting of and searching on processInstances.启动新流程实例，以及查询流程实例")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RuntimeService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRuntimeService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Access to form data and rendered forms for starting new process instances and completing tasks.没用过")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FormService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFormService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Exposes operations to manage human (standalone) tasks, such as claiming, completing and assigning tasks.任务查询与相关操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TaskService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTaskService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Service exposing information about ongoing and past process instances.流程实例历史记录")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HistoryService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHistoryService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Used for managing users, groups and the relations between them.用户相关,用不到")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IdentityService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIdentityService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Service for admin and maintenance operations on the process engine.检索数据库的元数据和表的信息，用不到")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ManagementService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getManagementService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Service providing access to the repository of process definitions and deployments.动态的改变流程的定义，并且不需要重新部署，用不到")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DynamicBpmnService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDynamicBpmnService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Service to manager process instance migrations.没用过")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessMigrationService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getProcessMigrationService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//......")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br")])]),a("h3",{attrs:{id:"_2-2-数据库说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-数据库说明"}},[t._v("#")]),t._v(" 2.2 数据库说明")]),t._v(" "),a("p",[t._v("最新的Flowable 6.6.0版本，如果只用流程引擎功能的话，部署时flowable会自动创建它所需要的47张表。")]),t._v(" "),a("h4",{attrs:{id:"_2-2-1-数据库表分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-数据库表分类"}},[t._v("#")]),t._v(" 2.2.1 数据库表分类")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("前缀")]),t._v(" "),a("th",[t._v("含义")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("ACT_RE_*")])]),t._v(" "),a("td",[t._v("RE表示repository")]),t._v(" "),a("td",[t._v("RepositoryService接口操作的表，如流程定义，流程的资源（图片，规则等）")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ACT_RU_*")])]),t._v(" "),a("td",[t._v("RU表示runtime")]),t._v(" "),a("td",[t._v("RuntimeService、TaskService运行时流程变量，用户任务，定时任务等，流程实例结束时将被删除")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ACT_ID_*")])]),t._v(" "),a("td",[t._v("ID表示identity")]),t._v(" "),a("td",[t._v("IdentityService存储如用户，用户组，权限等，flowable画图时，选择受理人或受理组就会查询这些表")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ACT_HI_*")])]),t._v(" "),a("td",[t._v("HI表示history")]),t._v(" "),a("td",[t._v("HistoryService历史的相关数据，如结束的流程实例，变量，任务等")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ACT_GE_*")])]),t._v(" "),a("td",[t._v("GE表示general")]),t._v(" "),a("td",[t._v("普通数据，各种情况都使用的数据")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("FLW_*")])]),t._v(" "),a("td"),t._v(" "),a("td")])])]),t._v(" "),a("h4",{attrs:{id:"_2-2-2-常用数据库表说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-常用数据库表说明"}},[t._v("#")]),t._v(" 2.2.2 常用数据库表说明")]),t._v(" "),a("ul",[a("li",[t._v("通用数据表")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("表名")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACT_GE_BYTEARRAY")]),t._v(" "),a("td",[t._v("通用的流程定义和流程资源")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_GE_PROPERTY")]),t._v(" "),a("td",[t._v("系统相关属性")])])])]),t._v(" "),a("ul",[a("li",[t._v("流程定义表")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("表名")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACT_RE_DEPLOYMENT")]),t._v(" "),a("td",[t._v("部署单元信息")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RE_MODEL")]),t._v(" "),a("td",[t._v("模型信息，通过flowable-modler画图程序时才会产生该记录")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RE_PROCDEF")]),t._v(" "),a("td",[t._v("已部署的流程定义")])])])]),t._v(" "),a("ul",[a("li",[t._v("历史记录表")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("表名")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACT_HI_PROCINST")]),t._v(" "),a("td",[t._v("历史的流程实例")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_TASKINST")]),t._v(" "),a("td",[t._v("历史的任务实例")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_ACTINST")]),t._v(" "),a("td",[t._v("历史的流转节点信息")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_ATTACHMENT")]),t._v(" "),a("td",[t._v("历史的流程附件")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_COMMENT")]),t._v(" "),a("td",[t._v("历史的说明性信息")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_DETAIL")]),t._v(" "),a("td",[t._v("历史的流程运行中的细节信息")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_IDENTITYLINK")]),t._v(" "),a("td",[t._v("历史的流程运行过程中用户关系")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_VARINST")]),t._v(" "),a("td",[t._v("历史的流程运行中的变量信息")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_ENTITYLINK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("ACT_HI_TSK_LOG")]),t._v(" "),a("td",[t._v("历史的流程运行中的日志信息")])])])]),t._v(" "),a("ul",[a("li",[t._v("用户权限表")])]),t._v(" "),a("p",[t._v("主要用于flowable自带的画图系统登录、管理认证后台登录")]),t._v(" "),a("p",[t._v("例如：http://localhost:8080/flowable-ui/#/， 账密：admin/test。部署方式参见"),a("code",[t._v("3.2.1 流程定义部署")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("表名")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACT_ID_BYTEARRAY")]),t._v(" "),a("td",[t._v("二进制数据表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_GROUP")]),t._v(" "),a("td",[t._v("用户组信息表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_INFO")]),t._v(" "),a("td",[t._v("用户信息详情表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_MEMBERSHIP")]),t._v(" "),a("td",[t._v("人与组关系表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_PRIV")]),t._v(" "),a("td",[t._v("权限表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_PRIV_MAPPING")]),t._v(" "),a("td",[t._v("用户或组权限关系表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_PROPERTY")]),t._v(" "),a("td",[t._v("属性表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_TOKEN")]),t._v(" "),a("td",[t._v("用户登录令牌日志表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_ID_USER")]),t._v(" "),a("td",[t._v("用户表")])])])]),t._v(" "),a("ul",[a("li",[t._v("运行实例表")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("表名")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACT_RU_TASK")]),t._v(" "),a("td",[t._v("运行时任务表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_EXECUTION")]),t._v(" "),a("td",[t._v("运行时流程执行实例")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_VARIABLE")]),t._v(" "),a("td",[t._v("运行时变量表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_TIMER_JOB")]),t._v(" "),a("td",[t._v("定时作业表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_JOB")]),t._v(" "),a("td",[t._v("运行时作业表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_IDENTITYLINK")]),t._v(" "),a("td",[t._v("运行时用户关系信息，候选用户、候选组")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_EVENT_SUBSCR")]),t._v(" "),a("td",[t._v("运行时事件")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_DEADLETTER_JOB")]),t._v(" "),a("td",[t._v("正在运行的任务表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_HISTORY_JOB")]),t._v(" "),a("td",[t._v("历史作业表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_SUSPENDED_JOB")]),t._v(" "),a("td",[t._v("暂停作业表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_ACTINST")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_ENTITYLINK")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("ACT_RU_EXTERNAL_JOB")]),t._v(" "),a("td")])])]),t._v(" "),a("ul",[a("li",[t._v("其他表")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("表名")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACT_EVT_LOG")]),t._v(" "),a("td",[t._v("事件日志表")])]),t._v(" "),a("tr",[a("td",[t._v("ACT_PROCDEF_INFO")]),t._v(" "),a("td",[t._v("流程定义信息")])]),t._v(" "),a("tr",[a("td",[t._v("FLW_CHANNEL_DEFINITION")]),t._v(" "),a("td",[t._v("泳池管道定义表")])]),t._v(" "),a("tr",[a("td",[t._v("FLW_EVENT_DEFINITION")]),t._v(" "),a("td",[t._v("事件定义")])]),t._v(" "),a("tr",[a("td",[t._v("FLW_EVENT_DEPLOYMENT")]),t._v(" "),a("td",[t._v("事件必输")])]),t._v(" "),a("tr",[a("td",[t._v("FLW_EVENT_RESOURCE")]),t._v(" "),a("td",[t._v("事件所需资源")])]),t._v(" "),a("tr",[a("td",[t._v("FLW_EV_DATABASECHANGELOG")]),t._v(" "),a("td",[t._v("Liquibase执行的记录")])]),t._v(" "),a("tr",[a("td",[t._v("FLW_EV_DATABASECHANGELOGLOCK")]),t._v(" "),a("td",[t._v("Liquibase执行锁")])]),t._v(" "),a("tr",[a("td",[t._v("FLW_RU_BATCH")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("FLW_RU_BATCH_PART")]),t._v(" "),a("td")])])]),t._v(" "),a("h3",{attrs:{id:"_2-3-运行原理说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-运行原理说明"}},[t._v("#")]),t._v(" 2.3 运行原理说明")]),t._v(" "),a("p",[t._v("目前，在系统中为了反映与现实的真实流程，工作流框架中通常都采用XML对送程进行描述定义。然后，由工作流引擎对XML数据结构解析，并将定义的流程节点和关联信息都序列化存储到数据库里。在序列化过程中将与业务表单建立关联，后续将依据上述定义的流程，进行业务上的流转。市面上工作流框架基本上都是基于这种实现方式。")]),t._v(" "),a("p",[t._v("所以从本质上说，工作流其实就是一种状态机，在配置好的既定流程下，根据当前不同的状态，执行不同的操作，然后流转到下一个状态。")]),t._v(" "),a("p",[t._v("工作流引擎比状态机实操性好的地方就在于它自带的数据库表，它的运行原理主要也是基于这些表。以"),a("code",[t._v("ACT_RU_*")]),t._v("系列表为例，借助它们，工作流能做到我们在业务流程发生变更后，业务代码可以不发生改变。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/views-img/2020120201/%E5%8E%9F%E7%90%86.png",alt:"原理"}})]),t._v(" "),a("p",[t._v("假定一个流程定义：开始 --\x3e 填写请假单--\x3e 部门经理审批--\x3e总经理审批--\x3e结束，从流程实例的开始到结束，会经历以下过程：")]),t._v(" "),a("ol",[a("li",[t._v("流程未开始，"),a("code",[t._v("ACT_RU_*")]),t._v("相关的表全是空的，即没有运行时数据。")]),t._v(" "),a("li",[t._v("流程开始，"),a("code",[t._v("ACT_RU_*")]),t._v("相关的表只会记录“填写请假单”相关的数据，表示当前状态是“填写请假单”，需要用户完成这个“填写请假单”任务。")]),t._v(" "),a("li",[t._v("用户处理完“填写请假单”，流程自动走到“部门经理审批”状态。"),a("code",[t._v("ACT_RU_*")]),t._v("相关的表会把之前“填写请假单”相关的数据全部删除，转而只会记录下“部门经理审批”相关的数据，表示当前流程卡在了“部门经理审批”。")]),t._v(" "),a("li",[t._v("等“部门经理审批”完这个请假单，流程就会走到“总经理审批”状态，"),a("code",[t._v("ACT_RU_*")]),t._v("相关的表就只会记录“总经理审批”，表示当前任务是“总经理审批”。")]),t._v(" "),a("li",[t._v("“总经理审批”通过后，流程实例销毁。"),a("code",[t._v("ACT_RU_*")]),t._v("会全部清空，即没有运行时的数据，也就是请假流程全部走完了。")])]),t._v(" "),a("h2",{attrs:{id:"_3-flowable工作流引擎实操"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-flowable工作流引擎实操"}},[t._v("#")]),t._v(" 3. flowable工作流引擎实操")]),t._v(" "),a("h3",{attrs:{id:"_3-1-环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-环境准备"}},[t._v("#")]),t._v(" 3.1 环境准备")]),t._v(" "),a("p",[t._v("flowable与spring boot整合后，使用起来特别方便。因为flowable提供了与spring boot集成的starter包，只需要引入jar包即可。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("starter")]),t._v(" "),a("th",[t._v("详细")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("flowable-spring-boot-starter-cmmn")]),t._v(" "),a("td",[t._v("包含CMMN案例管理引擎")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter-cmmn-rest")]),t._v(" "),a("td",[t._v("同上，另外包含REST API")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter-dmn")]),t._v(" "),a("td",[t._v("包含DMN决策表引擎")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter-dmn-rest")]),t._v(" "),a("td",[t._v("同上，另外包含REST API")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter-process")]),t._v(" "),a("td",[t._v("包含业务流程引擎，会自动扫描"),a("code",[t._v("resources/processes")]),t._v("下的"),a("code",[t._v(".bpmn20")]),t._v("、"),a("code",[t._v(".bpmn20.xml")]),t._v("文件并部署")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter-process-rest")]),t._v(" "),a("td",[t._v("同上，另外包含REST API")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter")]),t._v(" "),a("td",[t._v("包含flowable全家桶（Process流程引擎, CMMN案例管理引擎, DMN决策表引擎, Form表单, Content 以及 IDM用户认证）")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter-rest")]),t._v(" "),a("td",[t._v("同上，另外包含REST API")])]),t._v(" "),a("tr",[a("td",[t._v("flowable-spring-boot-starter-actuator")]),t._v(" "),a("td",[t._v("Spring启动的一些依赖")])])])]),t._v(" "),a("p",[a("strong",[t._v("一定要注意引入自己需要的就行了！")])]),t._v(" "),a("p",[t._v("我们一般只需要流程引擎相关的功能，所以只需要引入"),a("code",[t._v("flowable-spring-boot-starter-process-rest")]),t._v("即可。")]),t._v(" "),a("p",[a("strong",[t._v("注意")]),t._v("：在mvn repository里有一个"),a("code",[t._v("flowable-spring-boot-starter-basic")]),t._v("，这个其实就是"),a("code",[t._v("flowable-spring-boot-starter-process")]),t._v("，是改名的锅。")]),t._v(" "),a("p",[t._v("所以这次引入的maven依赖如下：")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flowable"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("flowable"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("starter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("process"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6.6")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 其他依赖 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("starter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" mysql数据库驱动 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("connector"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("接下来在application.yml配置数据源（略...），启动项目。")]),t._v(" "),a("p",[t._v("启动项目的时候，flowable一般会做两个动作")]),t._v(" "),a("ol",[a("li",[t._v("如果数据库中没有flowable需要的表，那么它会在数据库中自动创建它所需要的47张表，参照"),a("code",[t._v("2.2 数据库说明")]),t._v("。")]),t._v(" "),a("li",[t._v("如果项目存在资源文件夹processes，且存在未部署的流程定义，那么它会自动把流程定义进行部署，存入数据库中。")])]),t._v(" "),a("p",[a("strong",[t._v("注意")]),t._v("：如果启动时遇到"),a("code",[t._v("liquibase.exception.LockException")]),t._v("，需要手动把表名后缀为"),a("code",[t._v("databasechangeloglock")]),t._v("的字段"),a("code",[t._v("LOCKED")]),t._v("里的值由1改成0（原因可能是多次启动，中间有非正常停止项目导致的）。")]),t._v(" "),a("h3",{attrs:{id:"_3-2-流程定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-流程定义"}},[t._v("#")]),t._v(" 3.2 流程定义")]),t._v(" "),a("p",[t._v("流程定义是目前按照bpmn2.0标准去描述业务流程，bpmn2.0规范可参考官方文档："),a("a",{attrs:{href:"https://flowable.com/open-source/docs/bpmn/ch07a-BPMN-Introduction/",target:"_blank",rel:"noopener noreferrer"}},[t._v("BPMN 2.0 Introduction"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("然后你会发现，如果为了描述一个复杂的业务流程，纯手写bpmn文档太困难了。所以我们可以借助于flowable官方提供的流程设计器，绘制我们的流程图。")]),t._v(" "),a("p",[t._v("流程设计器的部署可以参考官方说明："),a("a",{attrs:{href:"https://flowable.com/open-source/downloads/",target:"_blank",rel:"noopener noreferrer"}},[t._v("流程设计器Downloads"),a("OutboundLink")],1),t._v("，最后部署完成的效果如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/views-img/2020120201/%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8.png",alt:"原理"}})]),t._v(" "),a("p",[t._v("画好流程图后，把流程图下载下来，会发现它其实就是个bpmn格式文件。")]),t._v(" "),a("h4",{attrs:{id:"_3-2-1-流程定义部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-流程定义部署"}},[t._v("#")]),t._v(" 3.2.1 流程定义部署")]),t._v(" "),a("p",[t._v("将绘制好的流程（bpmn文件）部署到flowable数据库中，这就是流程定义部署。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("自动部署")]),t._v(" "),a("p",[t._v("在项目的资源文件resources目录下新建processes文件夹，把制好的流程bpmn文件拷贝进去。在项目启动的时候，flowable会进行自动部署。")])]),t._v(" "),a("li",[a("p",[t._v("手动部署")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Deployment")]),t._v(" deployment "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" repositoryService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDeployment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 项目路径")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addClasspathResource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("classpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  业务归档（BAR）文件")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .addZipInputStream(inputStream)")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字节流")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .addInputStream(in)")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文本")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .addString(xml)")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])])]),t._v(" "),a("h4",{attrs:{id:"_3-3-2-流程定义的查询与删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-流程定义的查询与删除"}},[t._v("#")]),t._v(" 3.3.2 流程定义的查询与删除")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("流程定义的查询")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查询流程定义 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessDefinitionQuery")]),t._v(" processDefinitionQuery "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" repositoryService "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createProcessDefinitionQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//遍历查询结果 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessDefinition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" processDefinitionQuery "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processDefinitionKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("orderByProcessDefinitionVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//可以取流程定义的id、名称、key、版本、资源名称等等")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("流程定义的删除")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除流程定义，如果该流程定义已有流程实例启动则删除时出错")]),t._v("\nrepositoryService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteDeployment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deploymentId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置true级联删除流程定义，即使该流程有流程实例启动也可以删除，默认false非级别删除方式 ")]),t._v("\nrepositoryService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteDeployment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deploymentId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("ul",[a("li",[t._v("使用repositoryService删除流程定义")]),t._v(" "),a("li",[t._v("如果该流程定义下没有正在运行的流程，则可以用普通删除。")]),t._v(" "),a("li",[t._v("如果该流程定义下存在已经运行的流程，使用普通删除报错，可用级联删除方法将流程及相关记录全部删除。项目开发中使用级联删除的情况比较多，删除操作一般只开放给超级管理员使用。")])])])]),t._v(" "),a("h3",{attrs:{id:"_3-3-流程实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-流程实例"}},[t._v("#")]),t._v(" 3.3 流程实例")]),t._v(" "),a("p",[t._v("按照流程定义内容发起一个流程，这就是一个流程实例。")]),t._v(" "),a("p",[t._v("流程定义部署在flowable后，就可以在系统中通过flowable去管理该流程的执行，执行流程表示流程的一次执行。比如：部署系统请假流程后，如果某用户要申请请假，这时就需要执行这个流程，如果另外一个用户也要申请请假，则也需要执行该流程，每个执行互不影响，每个执行是单独的流程实例。")]),t._v(" "),a("h4",{attrs:{id:"_3-3-1-启动流程实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-启动流程实例"}},[t._v("#")]),t._v(" 3.3.1 启动流程实例")]),t._v(" "),a("p",[t._v("启动流程实例时，我们通常要指定的businesskey，什么是businesskey？")]),t._v(" "),a("p",[t._v("Businesskey：业务标识，通常为业务表的主键，业务标识和流程实例一一对应。业务标识来源于业务系统。存储业务标识就是根据业务标识来关联查询业务系统的数据。")]),t._v(" "),a("p",[t._v("比如：请假流程启动一个流程实例，就可以将请假单的id作为业务标识存储到flowable中，将来查询flowable的流程实例信息就可以获取请假单的id，从而关联查询业务系统数据库得到请假单信息。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据流程定义key启动流程，并绑定业务key")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessInstance")]),t._v(" processInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" runtimeService "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startProcessInstanceByKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" businessKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h4",{attrs:{id:"_3-3-2-流程实例的查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-流程实例的查询"}},[t._v("#")]),t._v(" 3.3.2 流程实例的查询")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取某个流程定义的所有流程实例 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" runtimeService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createProcessInstanceQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processDefinitionKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//可以读取到所有流程实例的id，业务标识businessKey，流程实例是否已经结束，是否处于挂起状态等等")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("在flowable实际应用时，查询流程实例列表时，可能还需要显示出业务系统的一些相关信息，比如：查询当前运行的请假流程列表，还需要将请假单名称、请假天数等信息显示出来，然而请假天数等信息只存在业务系统中，并不会存储在flowable数据库中，所以是无法通过flowable的api查询到请假天数等信息。")]),t._v(" "),a("p",[t._v("所以，必须通过businessKey（业务标识 ）关联查询业务系统的请假单表，查询出请假天数等信息。")]),t._v(" "),a("h4",{attrs:{id:"_3-3-3-流程实例的挂起与激活"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-流程实例的挂起与激活"}},[t._v("#")]),t._v(" 3.3.3 流程实例的挂起与激活")]),t._v(" "),a("p",[t._v("某些情况可能由于流程变更需要将当前运行的流程暂停而不是直接删除，流程暂停后将不会继续执行。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("全部流程实例挂起")]),t._v(" "),a("p",[t._v("即：流程定义挂起，该流程定义下边所有的流程实例全部暂停。流程定义为挂起状态，那么该流程定义将不允许启动新的流程实例，同时该流程定义下所有的流程实例将全部挂起暂停执行。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//流程定义挂起")]),t._v("\nrepositoryService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("suspendProcessDefinitionById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//流程定义激活")]),t._v("\nrepositoryService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("activateProcessDefinitionById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("单个流程实例挂起")]),t._v(" "),a("p",[t._v("针对单个流程执行挂起操作，某个流程实例挂起，则此流程不再继续执行，完成该流程实例的当前任务将报异常。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//流程实例挂起")]),t._v("\nruntimeService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("suspendProcessInstanceById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processInstanceId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//流程实例激活")]),t._v("\nruntimeService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("activateProcessInstanceById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processInstanceId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])])]),t._v(" "),a("h3",{attrs:{id:"_3-4-任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-任务"}},[t._v("#")]),t._v(" 3.4 任务")]),t._v(" "),a("p",[t._v("在进行业务流程建模时，每个流程节点常常会指定任务负责人，即：流程到达某个状态（流程节点）时，必须有该状态（流程节点）的负责人进行处理，其他人没有权限处理。这个任务负责人既可以是固定负责人，也可以是动态分配的负责人。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("固定负责人：在绘制bpmn流程图时，直接指定负责人名称。")])]),t._v(" "),a("li",[a("p",[t._v("动态负责人：这种分配存在多种方式，常用的就是用UEL表达式或者监听类来做")]),t._v(" "),a("ul",[a("li",[t._v("在绘制bpmn流程图时，用UEL表达式写入一个负责人名称的变量（如：${assignee}，就是指变量的名称是assignee），在实际创建流程实例的时候，对这个变量进行赋值即可，可参考"),a("code",[t._v("3.5 流程变量")]),t._v("。")]),t._v(" "),a("li",[t._v("写一个监听类，实现org.activiti.engine.delegate.TaskListener接口，在任务创建的时候，进行任务负责人的指定。这个简单，不做介绍了...")])])])]),t._v(" "),a("h4",{attrs:{id:"_3-4-1-查询任务和办理任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-查询任务和办理任务"}},[t._v("#")]),t._v(" 3.4.1 查询任务和办理任务")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//根据流程定义、分配负责人、业务key等等条件，查找当前负责人需要处理的任务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),t._v(" task"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" taskService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createTaskQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processDefinitionKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("taskAssignee")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("assignee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processInstanceBusinessKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("businessKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("singleResult")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//办理任务")]),t._v("\ntaskService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("complete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTaskId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[a("strong",[t._v("注意")]),t._v("：如果查不到任务，说明该流程还没有执行到这个流程节点，或者已经过了这个流程节点，也有可能当前用户没有权限处理这个流程节点。此时task为null，所以查询完任务，都是需要先判断一下task是否为null，再处理任务的，上述代码很明显是个反例。")]),t._v(" "),a("h3",{attrs:{id:"_3-5-流程变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-流程变量"}},[t._v("#")]),t._v(" 3.5 流程变量")]),t._v(" "),a("p",[t._v("流程变量在flowable中是一个非常重要的角色，流程运转有时需要靠流程变量，业务系统和flowable结合时少不了流程变量。")]),t._v(" "),a("p",[t._v("流程变量就是flowable在管理工作流时，根据管理需要而设置的变量。比如：在请假流程流转时，如果请假天数大于3天，则由总经理审核，否则由人事直接审核，那么其中的请假天数就可以设置为流程变量，在流程流转时使用。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/views-img/2020120201/%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F.png",alt:"原理"}})]),t._v(" "),a("h4",{attrs:{id:"_3-5-1-流程变量使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-1-流程变量使用场景"}},[t._v("#")]),t._v(" 3.5.1 流程变量使用场景")]),t._v(" "),a("ol",[a("li",[t._v("绘制流程图的时候，使用UEL表达式设置流程变量，来决定某个分支的流程走向，如：上面流程图里的"),a("code",[t._v("${num > 3}")])]),t._v(" "),a("li",[t._v("绘制流程图的时候，使用UEL表达式设置流程变量，来决定真正执行时流程实例节点的一些属性，如：可以在节点的assignee处设置UEL表达式"),a("code",[t._v("${assignee}")]),t._v("，表达式的值为任务的负责人。")]),t._v(" "),a("li",[t._v("等等...")])]),t._v(" "),a("h4",{attrs:{id:"_3-5-2-流程变量的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-2-流程变量的使用"}},[t._v("#")]),t._v(" 3.5.2 流程变量的使用")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("通过流程实例绑定流程变量")]),t._v(" "),a("p",[t._v("在启动流程时设置流程变量，或者流程执行了一段时候后再设置流程变量，变量的作用域是整个流程实例。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义流程变量 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//变量名是num，变量值是3。当然变量值也可以是一个对象 ")]),t._v("\nvariables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1.启动流程实例时，直接绑定业务key和流程变量")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessInstance")]),t._v(" processInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" runtimeService "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startProcessInstanceByKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" businessKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" variables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2.启动流程后，再根据流程实例Id把流程变量绑上去。")]),t._v("\nruntimeService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setVariables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processInstanceId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" variables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("通过任务节点绑定流程变量")]),t._v(" "),a("p",[t._v("在处理任务时设置流程变量，只有在该任务节点以及该节点之后的节点才可使用该变量。它的作用域是整个流程实例，如果设置的流程变量的key在流程实例中已存在相同的名字，则后设置的变量替换前边设置的变量。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//查询任务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),t._v(" task"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" taskService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createTaskQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processDefinitionKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processDefinitionKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("taskAssignee")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("assignee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processInstanceBusinessKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("businessKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("singleResult")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1.在任务上绑定流程变量，再处理任务")]),t._v("\ntaskService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setVariable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("taskId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2.处理任务的时候，直接绑定程变量")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nvariables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntaskService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("complete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("taskId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" variables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])])]),t._v(" "),a("h3",{attrs:{id:"_3-6-网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-网关"}},[t._v("#")]),t._v(" 3.6 网关")]),t._v(" "),a("h4",{attrs:{id:"_3-6-1-排他网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-1-排他网关"}},[t._v("#")]),t._v(" 3.6.1 排他网关")]),t._v(" "),a("p",[t._v("排他网关（也叫异或（XOR）网关），用来在流程中实现决策。当流程执行到这个网关，所有分支都会判断条件是否为true，如果为true则执行该分支。")]),t._v(" "),a("p",[t._v("那么问题来了，为什么要用排他网关？不用排他网关也可以实现分支，如："),a("code",[t._v("3.5 流程变量")]),t._v("的流程图所示。因为这个流程图如果条件都不满足，在不使用排他网关的情况下，流程就结束了（是异常结束）。")]),t._v(" "),a("p",[t._v("如果使用排他网关决定分支的走向，如下所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/views-img/2020120201/%E6%8E%92%E4%BB%96%E7%BD%91%E5%85%B3.png",alt:"原理"}})]),t._v(" "),a("p",[t._v("如果从网关出去的线所有条件都不满足，则系统抛出异常，但是流程不会结束。")]),t._v(" "),a("p",[a("strong",[t._v("注意")]),t._v("：排他网关只会选择一个为true的分支执行，所以必须要有一条分支可以走。(即使有两个分支条件都为true，排他网关也会只选择一条分支去执行)。")]),t._v(" "),a("h4",{attrs:{id:"_3-6-2-并行网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-2-并行网关"}},[t._v("#")]),t._v(" 3.6.2 并行网关")]),t._v(" "),a("p",[t._v("并行网关允许将流程分成多条分支，也可以把多条分支汇聚到一起，并行网关的功能是基于进入和外出顺序流的")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("fork分支：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。")])]),t._v(" "),a("li",[a("p",[t._v("join汇聚：所有到达并行网关，在此等待的进入分支， 直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。")])])]),t._v(" "),a("p",[a("strong",[t._v("注意")]),t._v("：如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。")]),t._v(" "),a("p",[t._v("以请假流程为例，如下图所示：在填写完请假单后，流程就走到了并行网关，并行网关要求部门经理审批，同时也要求总经理审批，只有当两个审批节点都完成了，才会走到人事存档流程节点。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/views-img/2020120201/%E5%B9%B6%E8%A1%8C%E7%BD%91%E5%85%B3.png",alt:"并行"}})]),t._v(" "),a("p",[t._v("与其他网关的主要区别是，并行网关不会解析条件（根本不需要条件）。即使顺序流中定义了条件，也会被忽略。")]),t._v(" "),a("h4",{attrs:{id:"_3-6-3-包容网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-3-包容网关"}},[t._v("#")]),t._v(" 3.6.3 包容网关")]),t._v(" "),a("p",[t._v("包容网关可以看做是排他网关和并行网关的结合体。 和排他网关一样，可以在外出顺序流上定义条件，包容网关会解析它们。但是主要的区别是包容网关可以选择多于一条顺序流，这和并行网关一样。")]),t._v(" "),a("p",[t._v("包容网关的功能是基于进入和外出顺序流的")]),t._v(" "),a("ul",[a("li",[t._v("分支：所有外出顺序流的条件都会被解析，结果为true的顺序流会以并行方式继续执行，会为每个顺序流创建一个分支。")]),t._v(" "),a("li",[t._v("汇聚：所有并行分支到达包容网关，会进入等待状态， 直到每个包容流程token的进入顺序流的分支都到达。 这是与并行网关的最大不同。换句话说，包容网关只会等待被选中执行了的进入顺序流。在汇聚之后，流程会穿过包容网关继续执行。")])]),t._v(" "),a("p",[t._v("以企业体检流程为例，如下流程图所示：通过流程变量userType来表示员工类型，如果等于1表示普通员工，如果等于2表示管理层员工，公司全体员工进行常规项检查、抽血化验，公司管理层除常规检查和抽血化验外，还要进行附加体检项检查。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/views-img/2020120201/%E5%8C%85%E5%AE%B9%E7%BD%91%E5%85%B3.png",alt:"包容"}})]),t._v(" "),a("h4",{attrs:{id:"_3-6-4-事件网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-4-事件网关"}},[t._v("#")]),t._v(" 3.6.4 事件网关")]),t._v(" "),a("p",[t._v("没用过...略...")])])}),[],!1,null,null,null);s.default=e.exports}}]);